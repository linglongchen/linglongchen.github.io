# 生产故障解决流程

作者：陈汤姆  
博客：[https://github.com/linglongchen/linglongchen.github.io](https://github.com/linglongchen/linglongchen.github.io)

> 自我学习的积累！😄

## 1. 背景

本文基于日常处理线上故障的总结，梳理了故障处理的流程，以便快速解决问题，减少故障影响面，降低资损。一般公司会有自己的标准流程，比如1-5-10（1分钟发现、5分钟止血、10分钟解决）。

## 2. 流程

### 2.1 故障背景

处理故障的第一步是了解故障的背景。对于紧急问题，首先关注核心点。关注点如下：

- 时间
- 问题
- 影响
- 现场负责人

故障背景模板：`时间 xxx 问题 xxx 产生了 xxx 影响，负责人 xxx`

### 2.2 确认故障前的改动类型

改动类型即故障背景中的问题，但单独列出以便处理。主要改动类型如下：

- **应用发布**：涉及代码改动
- **配置发布**：涉及业务侧、技术侧的配置改动
- **底层数据表变更**：涉及底层技术层变更

### 2.3 故障止血

解决故障的第一步是快速止血。不同的改动类型有不同的止血方式：

- **应用发布**：快速回滚（通常不会产生二次故障），直接进行回滚操作。
- **配置发布**：回滚配置，无论是业务侧还是技术侧，直接回滚配置。
- **数据表变更**：需要拉齐 DBA 进行紧急回滚，处理如字段长度问题、自增 ID 超过最大值等。

### 2.4 故障数据订正

故障止血后，处理故障产生的影响，合理安排组内人员一起解决。流程如下：

1. **确认影响范围**：与**改动人**确认影响的业务范围。
    - 部分影响？
    - 全量影响？
2. **捞取影响单量和明细**，优先修复高优先级订单（**同学1**做捞订单统计）。
3. **处理受影响订单（存量）**的解决方案（**同学2**提供解决方案）。
    - 订正
    - 补推
4. **紧急修复业务反馈的订单**（**同学3**修复业务反馈订单并验证解决方案）。
5. **修复方案**：
    - 修改代码
    - 订正数据
    - 配置变更

**注意点**：故障数据订正要分清主次，优先订正业务提供的数据，减少业务体感影响，然后处理高优先级数据，最后处理普通数据。

### 2.5 故障消除

故障止血并处理数据后，评估修复的数据是否存在级联的数据依赖。如果存在级联依赖，故障可能仍未消除。故障消除处理流程：

1. 整理故障影响数据明细
2. 拉通级联影响域确认数据影响
3. 确认故障数据修复解决方案
4. 保障故障数据最终结束生命周期
5. 确认故障最终消除

**注意点**：故障消除阶段最容易出现资损，一定要防范跨域的资损问题，确保彻底解决。

### 2.6 故障复盘

故障消除后，进行故障复盘。复盘的目的是反思和改进，而非问责。复盘文档应包括：

- **复盘参与人**：技术、产品、测试
- **复盘主持人**
- **问题描述**：一句话描述（xxx时间发生了xxx问题，影响了xxx业务）
- **原因**：一句话原因（让别人能快速理解）
- **故障处理流程**：给出故障处理的时间线，具体到分钟（xxx时间xxx人操作了xxx）
- **故障背景**：改动的背景及其必要性
- **故障原因分析**：发生故障的原因，发现哪些方面考虑欠缺
- **总结**：
    - 做的好的方面
    - 做的不好的方面及改进措施，指定到人，给出落地时间
- **故障定级**

### 2.7 故障解决注意点

- 止血时要拉齐组内的领导和技术核心人员确认，避免二次故障。
- 故障处理是争分夺秒的事情，审批人直接电话联系，迅速同步背景和影响面，确保审批人快速了解并处理。