# 生产故障解决流程

作者： 陈汤姆
<br/>博客：[https://github.com/linglongchen/linglongchen.github.io](https://github.com/linglongchen/linglongchen.github.io)

>自我学习的积累！😄




## 1.背景

本文基于自己日常处理线上故障的总结，梳理处理故障的流程，做到快速解决，减少故障影响面，降低资损。

故障的处理一般公司都有自己的标准，比如1-5-10（1分钟发现5分钟止血10分钟解决）

## 2.流程

### 2.1 故障背景
处理故障第一步要了解故障的产生背景，紧急问题只要关注核心点即可，因此关注点如下：
- 时间
- 问题
- 影响
- 现场负责人

因此模板如下：xxx时间xxx问题产生了xxx影响，负责人xxx。



### 2.2 确认故障前的改动类型

改动类型就是故障背景中的问题，但是这里单独作为一项是因为改动类型分为不同的场景，主要有如下两种：
- 应用发布：涉及代码改动
- 配置发布：涉及业务侧、技术侧的配置改动
- 底层数据表变更：涉及底层技术层变更

### 2.3 故障止血
解决故障第一步就是止血，止血、止血！！！故障发生了第一时间不考虑其它，第一时间要考虑如何快速止血。

不同的改动类型止血方式不同：

- 应用发布：快速回滚（一般回滚操作不会产生二次故障）所以直接拉齐测试快速回滚即可。
- 配置发布：配置回滚，无论业务侧还是技术侧直接回滚配置
- 数据表变更：字段长度问题（自增id超过int最大值）、自增id超过前端最大展示长度、数据库字段缺失等，数据表变更需要拉齐DBA做紧急回滚

### 2.4 故障数据订正

故障止血后就要处理故障产生的影响，这里需要合理安排组内同学一起处理，一般要拉齐三位同学一起解决，流程如下：
1. 确认影响范围（与**改动人**xxx确认影响的业务范围）
    1. 部分影响？
    2. 全量影响？
2. 捞影响单量和明细，优先修复高优先级订单（**同学1**xxx做捞订单统计）
3. 处理受影响订单（存量）的解决方案（**同学2**xxx提供解决方案）
	1. 订正
	2. 补推
4. 紧急修复业务反馈的订单（**同学3**xxx修复业务反馈订单验证解决方案）
5. 修复方案
	1. 修改代码
	2. 订正数据
	1. 配置变更


注意点：故障数据订正要分清主次，先订正业务提供的数据，做到业务体感降到最低，然后订正高优先级数据，最后订正普通数据，避免慌乱随便订正造成数据影响无法降低。

### 2.5 故障消除
故障止血并处理故障数据后，要评估修复的数据是否存在级联的数据依赖，如果存在那么故障依然没有消除，此时就要拉通级联的域确认修复方案。

故障消除处理流程：
1. 整理故障影响数据明细
2. 拉通级联影响域确认数据影响
3. 确认故障数据修复解决方案
4. 保障故障数据最终结束生命周期
5. 故障最终消除

注意点：故障消除阶段一定不能松懈，因为该阶段是最容易出现资损的阶段，前面影响了数据只是针对单域，如果跨域出现了资损那么问题会直接扩大化，一定要防范故障消除阶段的资损问题。


### 2.6 故障复盘

故障消除后就要做故障复盘，故障复盘不是问责而且反思找问题并提高警惕，我所经历的故障复盘没有指责，大家更多的是找到这次故障发生的原因，从事前、事中、事后是否都做好了，做的不好的有哪些，怎么改正。

故障复盘整体文档梳理如下：
##### 2.6.1 复盘参与人：技术、产品、测试
##### 2.6.2 复盘主持人
##### 2.6.3 问题描述：一句话描述（xxx时间发生了xxx问题影响了xxx业务）
##### 2.6.4 原因：一句话原因（让别人能快速理解）
##### 2.6.5 故障处理流程：给出故障处理的时间线，具体到分钟（xxx时间xxx人操作了xxx）
##### 2.6.6 故障背景：说一下为什么要改动这个点，基于什么业务背景做改动（主要发现这种改动到底有没有必要）
##### 2.6.7 故障原因分析：为什么会发生本次故障（主要找到哪方面考虑欠缺导致发生了这次故障）

##### 2.6.8 总结
- 做的好的
- 做的不好的，怎么改进，指定到人，要将改进的action落到指定的人并且给出能够落地的时间
##### 2.6.9 故障定级



### 2.7 故障解决注意点

- 止血时要拉齐组内的leader和技术核心人员一起确认，避免出现二次故障
- 故障是争分夺秒的事情，任何审批人直接电话拉齐，将背景和影响面同步给审批人，让审批人快速了解并审批。